<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>大圆绘图器</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/css/bootstrap.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-vue@latest/dist/bootstrap-vue.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/leaflet@latest/dist/leaflet.min.css"
    />
    <link rel="stylesheet" href="/static/site.css" />
  </head>

  <body>
    <div id="vueapp">
      <b-navbar type="dark" toggleable="lg" variant="info">
        <b-navbar-brand href="#">大圆绘图器</b-navbar-brand>

        <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>

        <b-collapse id="nav-collapse" is-nav>
          <b-navbar-nav>
            <b-nav-item href="#">帮助</b-nav-item>
            <b-nav-item href="#">显示设置</b-nav-item>
          </b-navbar-nav>

          <b-navbar-nav class="ml-auto">
            <b-nav-form>
              <b-form-tags
                v-model="raw_query"
                separator=" ,;"
                placeholder="以分号、空格或逗号分隔。"
                remove-on-delete
                :tag-validator="validator"
              >
              </b-form-tags>
              <b-button
                class="my-2 my-sm-0 btn-success"
                @click="send_request()"
              >
                搜索
              </b-button>
            </b-nav-form>
          </b-navbar-nav>
        </b-collapse>
      </b-navbar>
      <br />
      <b-container fluid>
        <b-modal
          id="airport"
          size="lg"
          v-model="airport_modal.show"
          v-if="airport_modal.airport"
        >
          <template v-slot:modal-title>
            <h3>
              {{airport_modal.airport}}
            </h3>
          </template>
          <b-list-group flush>
            <b-list-group-item>
              {{airport_modal.airport.名称}}（{{airport_modal.airport.IATA}},
              {{airport_modal.airport.ICAO}}）
            </b-list-group-item>
            <b-list-group-item>
              国家/地区和城市：{{airport_modal.airport.国家}}
              {{airport_modal.airport.城市}}
            </b-list-group-item>
            <b-list-group-item>
              经纬度：{{airport_modal.airport.文字坐标}}
            </b-list-group-item>
            <b-list-group-item>
              时区：{{airport_modal.airport.时区}}
              (UTC{{airport_modal.airport.时差}})
            </b-list-group-item>
          </b-list-group>
        </b-modal>

        <b-card-group columns style="column-count: 1;">
          <b-card header-tag="header" no-body v-show="raw_query.length > 0">
            <template v-slot:header>
              <h6 class="mb-0">
                地图（<a href="#" onclick="toggleFullScreen('#map')">全屏显示</a
                >）
              </h6>
            </template>
            <div id="map" style="height: 512px;"></div>
          </b-card>
          <b-card header="航线" no-body v-if="query.routes.length > 0">
            <b-list-group flush>
              <b-list-group-item v-for="x in query.routes">
                <p v-for="y in x.path">
                  从 {{y.起}} 到 {{y.终}}<br />
                  长 {{y.距离.toFixed(0)}} 公里，初始航向角
                  {{y.航向角.d.toFixed(0)}}°
                </p>
                <p v-if="x.direct_path">
                  中转总距离为 {{x.total_distance.toFixed(0)}} 公里，直飞距离为
                  {{x.direct_path.距离.toFixed(0)}} 公里，绕航率为
                  {{x.divert.toFixed(2)}}%。
                </p>
              </b-list-group-item>
            </b-list-group>
          </b-card>
        </b-card-group>
        <b-card-group columns style="column-count: 2;">
          <b-card header="设置">
            <div class="form-row">
              <div class="col-lg">
                <label>地图供应商<br />Provider</label>
                <select
                  class="form-control"
                  name="p"
                  v-model="map.provider"
                  placeholder="地图供应商"
                >
                  <option value="GaoDe" selected>高德 Autonavi (GaoDe)</option>
                  <option value="Google">谷歌 Google</option>
                </select>
              </div>
              <div class="col-lg">
                <label>地图模式<br />Mode</label>
                <select class="form-control" name="m" v-model="map.mode">
                  <option value="Map" selected>街道地图 Street Map</option>
                  <option value="Satellite">卫星图 Satellite </option>
                  <option value="Hybrid">
                    带街道的卫星图（仅谷歌）Satellite with Streets (Google Only)
                  </option>
                  <option value="Terrain">
                    地形图（仅谷歌）Terrain (Google Only)
                  </option>
                </select>
              </div>
              <div class="col-lg">
                <label>中央经线<br />Center Longitude</label>
                <b-form-input
                  v-model="map_center"
                  type="number"
                  min="-180"
                  max="179"
                ></b-form-input>
              </div>
            </div>
          </b-card>
          <b-card header="关于大圆绘图器">
            <table class="table">
              <thead>
                <th>用法</th>
                <th>例子</th>
              </thead>
              <tbody>
                <tr>
                  <td>查找机场</td>
                  <td>ORD</td>
                </tr>
                <tr>
                  <td>绘制航线</td>
                  <td>SFO-ICN-SIN</td>
                </tr>
                <tr>
                  <td>绘制航程</td>
                  <td>1000km@PEK</td>
                </tr>
              </tbody>
            </table>
            <p>可以用半角逗号隔开查询。</p>
            <p>
              使用了以下开源软件：vue.js、bootstrap-vue、axios、moment、moment-timezone。
              项目开源在
              <a href="https://github.com/DaZui/greatcirclemap"
                >https://github.com/DaZui/greatcirclemap </a
              >，网页是
              <a href="https://gcmap.hanming.li/">https://gcmap.hanming.li/</a>。
              请通过微信 13022055270 或者邮件 jason@hanming.li 联系我。
            </p>
          </b-card>
        </b-card-group>
      </b-container>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/vue@latest/dist/vue.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="static/bootstrap-vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@latest/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@latest/min/moment-with-locales.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-timezone@latest/builds/moment-timezone-with-data-2012-2022.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@latest/dist/leaflet.min.js"></script>
    <script src="static/leaflet_tools/leaflet.ChineseTmsProviders.1.js"></script>
    <script src="static/geodesic.js"></script>
    <script src="static/airport.js"></script>
    <script src="static/geodesic_leaflet.js"></script>
    <script src="static/schedule.js"></script>
  </body>
</html>
